<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ë„ APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤ ì†¡ë…„ì˜ ë°¤ ì´ˆëŒ€ì¥</title>
    
    <!-- Open Graph Tags for KakaoTalk/Social Sharing (ì¹´ì¹´ì˜¤í†¡ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •) -->
    <meta property="og:title" content="ğŸ† APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤ ì†¡ë…„ì˜ ë°¤ (2025.12.18)">
    <meta property="og:description" content="í•œ í•´ì˜ ë…¸ë ¥ê³¼ ë•€ì„ ì¶•í•˜í•˜ëŠ” íŠ¹ë³„í•œ ë°¤ì— ì—¬ëŸ¬ë¶„ì„ ì´ˆëŒ€í•©ë‹ˆë‹¤! (ë·”í˜, ì¥ê¸°ìë‘, ìƒí’ˆ ì¶”ì²¨)">
    <!-- ì•ˆì •ì ì¸ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆì˜ ëŒ€ì²´ ì´ë¯¸ì§€ URLë¡œ ìˆ˜ì • (Netlify ì˜¤ë¥˜ ë°©ì§€) -->
    <meta property="og:image" content="https://placehold.co/800x400/146B3A/F8B229?text=APM+ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤+ì†¡ë…„ì˜+ë°¤">
    <meta property="og:url" content="[ì—¬ê¸°ì— ì‹¤ì œ ì›¹ ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”]"> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Noto+Sans+KR:wght@300;400;700;900&family=Sunflower:wght@500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                        fun: ['Gaegu', 'cursive'],
                        title: ['Sunflower', 'sans-serif'],
                    },
                    colors: {
                        christmas: {
                            red: '#D42426',
                            green: '#146B3A',
                            gold: '#F8B229',
                            dark: '#1a1a1a'
                        }
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'pulse-gold': 'pulse-gold 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'snow': 'snow 10s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite', // ì¶”ê°€ëœ ì• ë‹ˆë©”ì´ì…˜
                    },
                    keyframes: {
                        'pulse-gold': {
                            '0%, 100%': { opacity: 1, color: '#F8B229' },
                            '50%': { opacity: .5, color: '#FFF' },
                        },
                        'snow': {
                            '0%': { transform: 'translateY(-10px)' },
                            '100%': { transform: 'translateY(100vh)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            opacity: 0.8;
            animation: snow 10s linear infinite;
        }
        .bg-pattern {
            background-color: #0f172a;
            background-image: radial-gradient(#ffffff 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.1;
        }
        /* ì´ì „ ë°˜ì§ì´ëŠ” íš¨ê³¼ CSS ì œê±°ë¨ */
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen overflow-x-hidden font-sans">

    <!-- ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ -->
    <div class="snow-container" id="snowContainer"></div>

    <!-- ë°°ê²½ íŒ¨í„´ -->
    <div class="fixed inset-0 bg-pattern z-0"></div>

    <div class="relative z-10 max-w-md mx-auto bg-slate-800 min-h-screen shadow-2xl border-x-4 border-christmas-gold/30">
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <div class="sticky top-0 z-50 flex bg-slate-900/90 backdrop-blur border-b border-white/10">
            <button onclick="switchTab('invite')" id="btn-invite" class="flex-1 py-4 text-center font-bold text-christmas-gold border-b-2 border-christmas-gold transition-all">
                <span class="text-xl">ğŸ’Œ ì´ˆëŒ€ì¥</span>
            </button>
            <button onclick="switchTab('schedule')" id="btn-schedule" class="flex-1 py-4 text-center font-bold text-gray-400 border-b-2 border-transparent hover:text-white transition-all">
                <span class="text-xl">ğŸ“… ì‹ìˆœì•ˆë‚´</span>
            </button>
        </div>

        <!-- 1í˜ì´ì§€: ì´ˆëŒ€ì¥ (ë©”ì¸) -->
        <div id="page-invite" class="animate-fade-in pb-20">
            <!-- ìƒˆë¡œìš´ íƒ€ì´í‹€ ì˜ì—­ (ì˜ì›… ì„¹ì…˜ ì‚­ì œ í›„ ìƒë‹¨ì— ë°°ì¹˜) -->
            <div class="pt-6 pb-4 text-center bg-slate-800/80">
                <!-- ì›ƒê¸´ ë“œë ˆìŠ¤ ì£¼ì¸ê³µ ìƒì§• ì¶”ê°€ -->
                <div class="text-5xl mb-2 flex justify-center space-x-4">
                    <span class="animate-bounce-slow" style="animation-delay: 0.2s;">ğŸ•º</span>
                    <span class="text-christmas-gold animate-bounce-slow">ğŸ‘‘</span>
                    <span class="animate-bounce-slow" style="animation-delay: 0.4s;">ğŸ’ƒ</span>
                </div>
                <!-- /ì›ƒê¸´ ë“œë ˆìŠ¤ ì£¼ì¸ê³µ ìƒì§• ì¶”ê°€ -->
                <p class="text-christmas-gold font-fun text-xl mb-1">Happy New Year!</p>
                <h1 class="text-3xl sm:text-4xl font-black font-title text-white drop-shadow-lg leading-tight">
                    <span class="text-christmas-gold text-2xl sm:text-3xl block mb-1">APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤</span>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 via-white to-green-500 block">2025 ì†¡ë…„ì˜ ë°¤</span>
                </h1>
            </div>
            <!-- /ìƒˆë¡œìš´ íƒ€ì´í‹€ ì˜ì—­ -->

            <!-- ì´ˆëŒ€ ë¬¸êµ¬ -->
            <div class="px-6 py-8 text-center space-y-6">
                <!-- Invitation Text Box & TTS Feature -->
                <div id="invitationTextBlock" class="bg-slate-700/50 p-6 rounded-2xl border border-white/10 backdrop-blur-sm">
                    <p id="invitationText" class="text-lg leading-relaxed text-gray-200">
                        í•œ í•´ ë™ì•ˆ ë•€ í˜ë¦¬ë©° í•¨ê»˜í•´ ì£¼ì‹ <br>
                        íšŒì›ë‹˜ë“¤ì„ ìœ„í•œ íŠ¹ë³„í•œ ë°¤!<br><br>
                        <span class="font-bold text-christmas-gold text-xl">"APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤ ì†¡ë…„ì˜ ë°¤"</span>ì—<br>
                        ì—¬ëŸ¬ë¶„ì„ ì •ì¤‘íˆ ì´ˆëŒ€í•©ë‹ˆë‹¤.
                    </p>
                    
                    <!-- TTS Button -->
                    <button id="ttsButton" onclick="readInvitation()" class="mt-4 w-full px-4 py-2 bg-christmas-red hover:bg-red-700 text-white font-bold rounded-full shadow-lg transition duration-200 flex items-center justify-center">
                        <span class="text-xl mr-2">ğŸ”Š</span> ì´ˆëŒ€ì¥ ì½ì–´ì£¼ê¸° (TTS)
                    </button>
                    <audio id="ttsAudio" class="hidden w-full mt-4" controls></audio>
                </div>
                
                <!-- RSVP Suggestion Feature (LLM) -->
                <div class="bg-slate-700/50 p-6 rounded-2xl border border-christmas-gold/50 backdrop-blur-sm">
                    <h3 class="text-xl font-bold text-christmas-gold mb-3">âœ¨ ëŒ“ê¸€/ì‘ë‹µ ì¶”ì²œ (Gemini AI)</h3>
                    <p class="text-sm text-gray-300 mb-3">ì–´ë–¤ ì¬ë¯¸ìˆëŠ” ëŒ“ê¸€ì„ ë‚¨ê¸¸ì§€ ê³ ë¯¼ë˜ì„¸ìš”? ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
                    <div id="rsvpSuggestionOutput" class="min-h-[50px] bg-slate-900 p-3 rounded-lg text-sm text-yellow-300 italic mb-3 flex items-center justify-center text-center">
                        ì¶”ì²œ ëŒ“ê¸€ì´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
                    </div>
                    <button id="rsvpButton" onclick="generateRsvpSuggestion()" class="w-full px-4 py-2 bg-christmas-gold hover:bg-yellow-400 text-christmas-dark font-bold rounded-full shadow-lg transition duration-200 flex items-center justify-center">
                        <span class="text-xl mr-2">âœï¸âœ¨</span> ì¬ë¯¸ìˆëŠ” ëŒ“ê¸€ ì¶”ì²œë°›ê¸°
                    </button>
                </div>

                <!-- ì¼ì‹œ ë° ì¥ì†Œ -->
                <div class="space-y-4 mt-8">
                    <div class="flex items-center justify-center space-x-3 bg-slate-900 p-4 rounded-xl border border-christmas-red/50">
                        <div class="text-3xl">ğŸ“…</div>
                        <div class="text-left">
                            <p class="text-sm text-gray-400">Date</p>
                            <p class="text-xl font-bold text-white">2025.12.18 (ëª©)</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-center space-x-3 bg-slate-900 p-4 rounded-xl border border-christmas-green/50">
                        <div class="text-3xl">â°</div>
                        <div class="text-left">
                            <p class="text-sm text-gray-400">Time</p>
                            <p class="text-xl font-bold text-white">ì €ë… 7ì‹œë¶€í„° ~ ìì •</p>
                        </div>
                    </div>
                </div>

                <!-- ë“œë ˆìŠ¤ ì½”ë“œ -->
                <div class="mt-10">
                    <h3 class="text-2xl font-fun font-bold text-christmas-gold mb-6 decoration-wavy underline decoration-christmas-red">ğŸ¥» Dress Code</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/10 p-4 rounded-xl">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div class="w-8 h-8 rounded-full bg-red-600 shadow-lg border-2 border-white"></div>
                                <div class="w-8 h-8 rounded-full bg-green-600 shadow-lg border-2 border-white"></div>
                            </div>
                            <p class="font-bold">í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì»¬ëŸ¬</p>
                            <p class="text-xs text-gray-400">ë¹¨ê°• & ì´ˆë¡ í¬ì¸íŠ¸!</p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-xl">
                            <div class="flex justify-center space-x-2 mb-2">
                                <div class="w-8 h-8 rounded-full bg-black shadow-lg border-2 border-white"></div>
                                <div class="w-8 h-8 rounded-full bg-white shadow-lg border-2 border-gray-300"></div>
                            </div>
                            <p class="font-bold">ì‹œí¬í•œ ê¸°ë³¸</p>
                            <p class="text-xs text-gray-400">ë¸”ë™ & í™”ì´íŠ¸</p>
                        </div>
                    </div>
                    <!-- 'ì›ƒê¸°ëŠ” ë“œë ˆìŠ¤ ì£¼ì¸ê³µ' ë° AI í™œìš© ì•ˆë‚´ ì„¹ì…˜ì´ ì œê±°ë¨ -->
                </div>
            </div>
        </div>

        <!-- 2í˜ì´ì§€: ì‹ìˆœ ì•ˆë‚´ (ìŠ¤ì¼€ì¤„) -->
        <div id="page-schedule" class="hidden animate-fade-in pb-20">
            <div class="bg-christmas-red p-6 text-center rounded-b-3xl shadow-lg mb-8">
                <h2 class="text-3xl font-title font-bold text-white">Time Table</h2>
                <p class="text-white/80 font-fun mt-2">ì˜¤ëŠ˜ ë°¤, ì£¼ì¸ê³µì€ ì—¬ëŸ¬ë¶„ì…ë‹ˆë‹¤!</p>
            </div>

            <div class="px-6 relative">
                <!-- íƒ€ì„ë¼ì¸ ë¼ì¸ -->
                <div class="absolute left-10 top-0 bottom-0 w-1 bg-white/20"></div>

                <!-- 19:00 ì…ì¥ -->
                <div class="flex mb-8 relative">
                    <div class="w-16 flex-shrink-0 flex flex-col items-center z-10">
                        <div class="w-8 h-8 bg-christmas-green rounded-full flex items-center justify-center border-4 border-slate-800 font-bold text-xs">Start</div>
                    </div>
                    <div class="bg-slate-700/50 p-5 rounded-r-2xl rounded-bl-2xl flex-1 border-l-4 border-christmas-green ml-4">
                        <div class="flex justify-between items-baseline mb-2">
                            <span class="font-bold text-xl text-christmas-green">19:00</span>
                            <span class="text-sm bg-christmas-green/20 px-2 py-1 rounded text-green-300">ì…ì¥</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">í¬í† íƒ€ì„ & ë·”í˜ ğŸ±</h3>
                        <p class="text-gray-300 text-sm">í¬í† ì¡´ì—ì„œ ì¸ìƒìƒ· ì°°ì¹µ! ğŸ“¸<br>ì¤€ë¹„ëœ ë§›ìˆëŠ” ìŒì‹ê³¼ ì™€ì¸ì„ ì¦ê²¨ì£¼ì„¸ìš”.</p>
                    </div>
                </div>

                <!-- 19:30 1ë¶€ -->
                <div class="flex mb-8 relative">
                    <div class="w-16 flex-shrink-0 flex flex-col items-center z-10">
                        <div class="w-4 h-4 bg-christmas-red rounded-full border-2 border-slate-800"></div>
                    </div>
                    <div class="bg-slate-700/50 p-5 rounded-r-2xl rounded-bl-2xl flex-1 border-l-4 border-christmas-red ml-4">
                        <div class="flex justify-between items-baseline mb-2">
                            <span class="font-bold text-xl text-christmas-red">19:30</span>
                            <span class="text-sm bg-christmas-red/20 px-2 py-1 rounded text-red-300">1ë¶€ ì‹œì‘</span>
                        </div>
                        <h3 class="text-lg font-bold mb-3">ğŸ§¨ ì¥ê¸°ìë‘ Part.1</h3>
                        <div class="space-y-2 text-sm">
                            <div class="bg-slate-800 p-3 rounded-lg flex items-center gap-2">
                                <span class="text-xl">ğŸ€</span>
                                <div>
                                    <span class="font-bold text-pink-400">ì—¬ê±¸ì‹ìŠ¤</span>
                                    <p class="text-xs text-gray-400">í…”ë¯¸í…”ë¯¸ / ë¡¤ë¦¬í´ë¦¬ / ëŸ°íˆ¬ìœ </p>
                                </div>
                            </div>
                            <div class="bg-slate-800 p-3 rounded-lg flex items-center gap-2">
                                <span class="text-xl">ğŸ€</span>
                                <div>
                                    <span class="font-bold text-blue-400">ì•„.ìš°.ë””</span>
                                    <p class="text-xs text-gray-400">ê¹Œíƒˆë ˆë‚˜ / ì†Œë°©ì°¨</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10 text-sm text-yellow-300 font-bold">
                            âœ¨ ìƒí’ˆ ì¶”ì²¨ ë° ê°ì¢… ê²Œì„ ì§„í–‰
                        </div>
                    </div>
                </div>

                <!-- ë¸Œë ˆì´í¬ íƒ€ì„ -->
                <div class="flex mb-8 relative">
                    <div class="w-16 flex-shrink-0 flex flex-col items-center z-10">
                        <div class="w-4 h-4 bg-gray-400 rounded-full border-2 border-slate-800"></div>
                    </div>
                    <div class="bg-slate-700/30 p-4 rounded-r-2xl rounded-bl-2xl flex-1 ml-4 text-center">
                        <span class="font-bold text-gray-400">â˜• Break Time (10ë¶„)</span>
                        <p class="text-xs text-gray-500 mt-1">ê°„ì‹ê³¼ í›„ì‹ìœ¼ë¡œ ë‹¹ ì¶©ì „!</p>
                    </div>
                </div>

                <!-- 2ë¶€ -->
                <div class="flex mb-8 relative">
                    <div class="w-16 flex-shrink-0 flex flex-col items-center z-10">
                        <div class="w-4 h-4 bg-christmas-gold rounded-full border-2 border-slate-800 animate-pulse"></div>
                    </div>
                    <div class="bg-slate-700/50 p-5 rounded-r-2xl rounded-bl-2xl flex-1 border-l-4 border-christmas-gold ml-4">
                        <div class="flex justify-between items-baseline mb-2">
                            <span class="font-bold text-xl text-christmas-gold">Part 2</span>
                            <span class="text-sm bg-yellow-500/20 px-2 py-1 rounded text-yellow-300">í•˜ì´ë¼ì´íŠ¸</span>
                        </div>
                        
                        <div class="mb-4">
                            <h3 class="font-bold mb-1">ğŸ’ƒ ë‹¨ì²´ ëŒ„ìŠ¤ (ìºë¡¤)</h3>
                        </div>

                        <div class="bg-gradient-to-br from-yellow-900/50 to-slate-800 p-4 rounded-xl border border-yellow-600/30 mb-4">
                            <h3 class="font-bold text-yellow-400 text-center mb-3">ğŸ† APM ì–´ì›Œì¦ˆ ì‹œìƒì‹</h3>
                            <ul class="text-sm space-y-1 text-gray-300 text-center font-fun">
                                <li>ë•¡íë² ë¦¬ê°ìƒ ğŸ“</li>
                                <li>ë¹„ê°€ì˜¤ë‚˜ëˆˆì´ì˜¤ë‚˜ìƒ â˜”</li>
                                <li>í”ë“¤ì–´ì¬ë¼ìƒ ğŸ•º</li>
                                <li>ìœ„ê³ ë¹„ê·¸ì´ìƒìƒ ğŸ’Š</li>
                                <li>ìœ¼ë¦¬ìœ¼ë¦¬ì˜ë¦¬ìƒ ğŸ‘Š</li>
                                <li>ë–¡ìƒ ğŸ“ˆ</li>
                            </ul>
                            <div class="mt-3 bg-yellow-600 text-black text-center font-bold text-xs py-1 rounded shadow-lg animate-pulse">
                                ğŸ í•œë‹¬ ë¬´ë£Œ ìˆ˜ê°•ê¶Œ ì¶”ì²¨!
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mb-3">ğŸ§¨ ì¥ê¸°ìë‘ Part.2</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between items-center bg-slate-800 p-2 rounded">
                                <span>ğŸ€ ì˜¤ì „ë¶€ <span class="text-gray-400 text-xs">- ì£¼ì‹œê³ </span></span>
                            </div>
                            <div class="text-center text-xs text-yellow-200 py-1">--- ìƒí’ˆ ì¶”ì²¨ ---</div>
                            <div class="flex justify-between items-center bg-slate-800 p-2 rounded">
                                <span>ğŸ€ ì €ë…ë¶€ <span class="text-gray-400 text-xs">- ì•„ë‚˜ê¹Œë‚˜</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í”¼ë‚ ë ˆ -->
                <div class="flex mb-8 relative">
                    <div class="w-16 flex-shrink-0 flex flex-col items-center z-10">
                        <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center border-4 border-slate-800 font-bold text-xs">End</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-900/60 to-slate-700/50 p-5 rounded-r-2xl rounded-bl-2xl flex-1 border-l-4 border-purple-500 ml-4">
                        <div class="flex justify-between items-baseline mb-2">
                            <span class="font-bold text-xl text-purple-400">22:00 ~</span>
                            <span class="text-sm bg-purple-500/20 px-2 py-1 rounded text-purple-300">ê´‘ë€ì˜ ë°¤</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">ğŸ”¥ ëŒ„ìŠ¤ë°°í‹€ & ì‹œìƒ</h3>
                        <p class="text-gray-300 text-sm">ê°ì¢… ê²Œì„ & íŒŒí‹° ë§ˆë¬´ë¦¬</p>
                        <p class="text-xs text-gray-400 mt-2">*ê³µì‹ ì¢…ë£ŒëŠ” 10ì‹œì§€ë§Œ, ìì •ê¹Œì§€ ë‹¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ˜</p>
                    </div>
                </div>
            </div>
            
            <div class="text-center p-8 text-gray-500 text-xs">
                &copy; 2025 APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤<br>
                All rights reserved.
            </div>
        </div>
    </div>

    <script>
        // --- Gemini API Configuration and Helpers ---
        const apiKey = "";
        
        // Helper to convert base64 to ArrayBuffer
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // Helper to convert signed 16-bit PCM to WAV format
        function pcmToWav(pcm16, sampleRate = 24000) {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const byteRate = sampleRate * numChannels * bytesPerSample;
            const blockAlign = numChannels * bytesPerSample;
            const dataSize = pcm16.length * bytesPerSample;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);
            let offset = 0;

            // RIFF chunk
            view.setUint32(offset, 0x52494646, false); offset += 4; // "RIFF"
            view.setUint32(offset, 36 + dataSize, true); offset += 4; // File size - 8
            view.setUint32(offset, 0x57415645, false); offset += 4; // "WAVE"

            // fmt chunk
            view.setUint32(offset, 0x666d7420, false); offset += 4; // "fmt "
            view.setUint32(offset, 16, true); offset += 4; // Sub-chunk size (16 for PCM)
            view.setUint16(offset, 1, true); offset += 2; // Audio format (1 for PCM)
            view.setUint16(offset, numChannels, true); offset += 2; // Number of channels
            view.setUint32(offset, sampleRate, true); offset += 4; // Sample rate
            view.setUint32(offset, byteRate, true); offset += 4; // Byte rate
            view.setUint16(offset, blockAlign, true); offset += 2; // Block align
            view.setUint16(offset, bytesPerSample * 8, true); offset += 2; // Bits per sample (16)

            // data chunk
            view.setUint32(offset, 0x64617461, false); offset += 4; // "data"
            view.setUint32(offset, dataSize, true); offset += 4; // Data size

            // Write PCM data (16-bit signed)
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(offset, pcm16[i], true);
                offset += 2;
            }

            return new Blob([buffer], { type: 'audio/wav' });
        }
        
        // --- Main LLM Functions ---
        const apiUrlLLM = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        const apiUrlTts = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }
                    return response;
                } catch (error) {
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        console.warn(`Retry attempt ${i + 1} failed. Retrying in ${delay}ms.`, error.message);
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw error;
                    }
                }
            }
        }


        async function readInvitation() {
            const ttsButton = document.getElementById('ttsButton');
            const ttsAudio = document.getElementById('ttsAudio');
            const invitationTextElement = document.getElementById('invitationText');
            
            // Extract and clean the text content
            const rawText = invitationTextElement.innerText || invitationTextElement.textContent;
            const textToSpeak = rawText.replace(/\s+/g, ' ').trim(); 
            
            if (!textToSpeak) {
                alertBox('ìŒì„±ìœ¼ë¡œ ë³€í™˜í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            ttsButton.disabled = true;
            ttsButton.innerHTML = '<span class="text-xl mr-2">ğŸ§</span> ìŒì„± ìƒì„± ì¤‘...';
            ttsAudio.classList.add('hidden');
            ttsAudio.pause();
            ttsAudio.removeAttribute('src');

            try {
                const payload = {
                    contents: [{
                        parts: [{ text: `í™œê¸°ì°¨ê³  ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¡œ í•œêµ­ì–´ë¡œ ë§í•´ì£¼ì„¸ìš”: ${textToSpeak}` }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                // Kore: Firm, suitable for a formal-but-fun invitation
                                prebuiltVoiceConfig: { voiceName: "Kore" }
                            }
                        }
                    }
                };
                
                const response = await fetchWithBackoff(apiUrlTts, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                    
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    ttsAudio.src = audioUrl;
                    ttsAudio.classList.remove('hidden');
                    ttsAudio.play();
                    
                } else {
                    throw new Error('TTS APIì—ì„œ ìœ íš¨í•œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('TTS ì—ëŸ¬:', error);
                alertBox('ìŒì„± ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 'error');
            } finally {
                ttsButton.disabled = false;
                ttsButton.innerHTML = '<span class="text-xl mr-2">ğŸ”Š</span> ì´ˆëŒ€ì¥ ì½ì–´ì£¼ê¸° (TTS)';
            }
        }
        
        async function generateRsvpSuggestion() {
            const rsvpButton = document.getElementById('rsvpButton');
            const rsvpOutput = document.getElementById('rsvpSuggestionOutput');
            
            rsvpButton.disabled = true;
            rsvpButton.innerHTML = '<span class="text-xl mr-2">â³</span> ì•„ì´ë””ì–´ ìƒê° ì¤‘...';
            rsvpOutput.classList.remove('text-yellow-300', 'italic');
            rsvpOutput.classList.add('text-gray-400');
            rsvpOutput.innerText = 'AIê°€ ì‘ë‹µì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...';

            const userQuery = "APM ë‹¤ì´ì–´íŠ¸ ëŒ„ìŠ¤ ì†¡ë…„ì˜ ë°¤ ì´ˆëŒ€ì¥ì…ë‹ˆë‹¤. ì´ ëª¨ì„ì˜ ë¶„ìœ„ê¸°(ì¶¤, ìš´ë™, íŒŒí‹°)ì— ë§ê²Œ, ì¬ë¯¸ìˆê³  ìœ ë¨¸ëŸ¬ìŠ¤í•˜ë©° ì°¸ì„ì— ëŒ€í•œ ì—´ì •ì„ ë³´ì—¬ì£¼ëŠ” í•œêµ­ì–´ ëŒ“ê¸€ì„ í•˜ë‚˜ë§Œ ìƒì„±í•´ ì£¼ì„¸ìš”. (1ë¬¸ì¥ìœ¼ë¡œ ì§§ê²Œ)";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: "ë‹¹ì‹ ì€ APM ë‹¤ì´ì–´íŠ¸ëŒ„ìŠ¤ ë™í˜¸íšŒ ì†¡ë…„íšŒì— ì°¸ì„í•˜ëŠ” í™œê¸°ì°¨ê³  ì¬ë¯¸ìˆëŠ” íšŒì›ì…ë‹ˆë‹¤. ì‘ë‹µì€ ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê³  ê¸ì •ì ì´ì–´ì•¼ í•˜ë©°, ëŒ„ìŠ¤ ê´€ë ¨ ìš©ì–´ ë˜ëŠ” ìœ ë¨¸ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°ê³¼ë§Œ í•œêµ­ì–´ë¡œ ì¶œë ¥í•˜ì„¸ìš”." }]
                }
            };

            try {
                const response = await fetchWithBackoff(apiUrlLLM, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "ëŒ“ê¸€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                
                rsvpOutput.innerText = generatedText.trim().replace(/^['"]|['"]$/g, ''); // Remove quotes if LLM added them
                rsvpOutput.classList.add('text-yellow-300', 'italic');
                rsvpOutput.classList.remove('text-gray-400');
                
            } catch (error) {
                console.error('LLM ì—ëŸ¬:', error);
                rsvpOutput.innerText = 'ëŒ“ê¸€ ì¶”ì²œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (API ì˜¤ë¥˜)';
                rsvpOutput.classList.add('text-red-400');
                rsvpOutput.classList.remove('text-yellow-300', 'italic');
            } finally {
                rsvpButton.disabled = false;
                rsvpButton.innerHTML = '<span class="text-xl mr-2">âœï¸âœ¨</span> ì¬ë¯¸ìˆëŠ” ëŒ“ê¸€ ì¶”ì²œë°›ê¸°';
            }
        }
        
        // Custom Alert Box (replacing alert())
        function alertBox(message, type = 'info') {
            const container = document.createElement('div');
            container.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-lg shadow-xl z-[9999] transition-opacity duration-300';
            
            if (type === 'error') {
                container.classList.add('bg-red-600', 'text-white');
            } else {
                container.classList.add('bg-blue-600', 'text-white');
            }
            
            container.textContent = message;
            document.body.appendChild(container);

            setTimeout(() => {
                container.style.opacity = '0';
                setTimeout(() => container.remove(), 300);
            }, 3000);
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜ (ê¸°ì¡´ í•¨ìˆ˜)
        function switchTab(tabName) {
            const pageInvite = document.getElementById('page-invite');
            const pageSchedule = document.getElementById('page-schedule');
            const btnInvite = document.getElementById('btn-invite');
            const btnSchedule = document.getElementById('btn-schedule');

            if (tabName === 'invite') {
                pageInvite.classList.remove('hidden');
                pageSchedule.classList.add('hidden');
                
                btnInvite.classList.add('text-christmas-gold', 'border-christmas-gold');
                btnInvite.classList.remove('text-gray-400', 'border-transparent');
                
                btnSchedule.classList.add('text-gray-400', 'border-transparent');
                btnSchedule.classList.remove('text-christmas-gold', 'border-christmas-gold');
            } else {
                pageInvite.classList.add('hidden');
                pageSchedule.classList.remove('hidden');
                
                btnSchedule.classList.add('text-christmas-gold', 'border-christmas-gold');
                btnSchedule.classList.remove('text-gray-400', 'border-christmas-gold');
                
                btnInvite.classList.add('text-gray-400', 'border-transparent');
                btnInvite.classList.remove('text-christmas-gold', 'border-christmas-gold');
            }
        }
        
        // ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ ìƒì„± (ê¸°ì¡´ í•¨ìˆ˜)
        function createSnowflakes() {
            const container = document.getElementById('snowContainer');
            const snowflakeCount = 30;

            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.innerHTML = 'â„';
                snowflake.className = 'snowflake';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = Math.random() * 5 + 5 + 's';
                snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
                snowflake.style.opacity = Math.random();
                container.appendChild(snowflake);
            }
        }

        window.onload = createSnowflakes;
    </script>
</body>
</html>